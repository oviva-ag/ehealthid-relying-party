package com.oviva.ehealthid.fedclient.api;

import static org.junit.jupiter.api.Assertions.*;

import java.time.Instant;
import org.junit.jupiter.api.Test;

class ExtendedJWKSetJWSTest {

  @Test
  void parse() {

    var eJwks =
        ExtendedJWKSetJWS.parse(
            """
        eyJraWQiOiJqd3RzaWduZXItMjAyNCIsInR5cCI6Imp3ay1zZXQranNvbiIsImFsZyI6IkVTMjU2In0.eyJpc3MiOiJodHRwczovL2lkYnJva2VyLnRrLmVoZWFsdGgtaWQuZGUiLCJleHAiOjE3MjkyNTY5NzUsImlhdCI6MTcyOTE3MDU3NSwia2V5cyI6W3sia3R5IjoiRUMiLCJ4NXQjUzI1NiI6IjNZNHU1TS1IMGJtSE5GTjdqZER3V3NrNktsU01tOFUtbUEzMXM1Szg4OVEiLCJuYmYiOjE3MDc4MTU1MDQsInVzZSI6InNpZyIsImNydiI6IlAtMjU2Iiwia2lkIjoiand0c2lnbmVyLTIwMjQiLCJ4NWMiOlsiTUlJQi9qQ0NBYU9nQXdJQkFnSUVTSXlhSmpBTUJnZ3Foa2pPUFFRREFnVUFNSFF4Q3pBSkJnTlZCQWdUQWtKWE1SRXdEd1lEVlFRSEV3aEZhRzVwYm1kbGJqRUxNQWtHQTFVRUJoTUNSRVV4RERBS0JnTlZCQW9UQTBsQ1RURVlNQllHQTFVRUN4TVBVMlZyU1VSUUlGQnliMlFnVkVWRk1SMHdHd1lEVlFRREV4UktWMVJUYVdkdVpYSXRNakF5TkNCUVZTQlVTekFlRncweU5EQXlNVE13T1RFeE5EUmFGdzB5TlRBek1UY3dPVEV4TkRSYU1IUXhDekFKQmdOVkJBZ1RBa0pYTVJFd0R3WURWUVFIRXdoRmFHNXBibWRsYmpFTE1Ba0dBMVVFQmhNQ1JFVXhEREFLQmdOVkJBb1RBMGxDVFRFWU1CWUdBMVVFQ3hNUFUyVnJTVVJRSUZCeWIyUWdWRVZGTVIwd0d3WURWUVFERXhSS1YxUlRhV2R1WlhJdE1qQXlOQ0JRVlNCVVN6QlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJJOUJQNUdaOG1hMG5GQUMySE1jQTVDWnhsWkFodHVGY2xpaEk2Vm5KVXVzZjBBN1hhVWpicktYNDJsbVJ5ci9seWpuWFBYQktWd0p0UWJlcUxFVGZYeWpJVEFmTUIwR0ExVWREZ1FXQkJSTDNxZUpFWU51T2tmUmhubmtHbTMySFl6Uml6QU1CZ2dxaGtqT1BRUURBZ1VBQTBjQU1FUUNJQ2JPQldyTGlNSGduT2tNZjJSWWduTXVmZitKWnZqWXVCRjZiRVlja1pOQ0FpQlF1SmhZaTl0cXJrVkJNZjhRVFdacUI5K2hBM2lvQ3dXTzFTNFM2S2RSZVE9PSJdLCJ4IjoiajBFX2tabnlaclNjVUFMWWN4d0RrSm5HVmtDRzI0VnlXS0VqcFdjbFM2dyIsInkiOiJmMEE3WGFVamJyS1g0MmxtUnlyX2x5am5YUFhCS1Z3SnRRYmVxTEVUZlh3IiwiZXhwIjoxNzQyMjAyNzA0LCJhbGciOiJFUzI1NiJ9LHsia3R5IjoiRUMiLCJ4NXQjUzI1NiI6IkFPd1E1QTl6N1drRF96X2FXUVI1Um9RdlRyUGdLNVlFQnZDNVB2UjRzR3MiLCJuYmYiOjE3MDc4MTU1NzMsInVzZSI6InNpZyIsImNydiI6IlAtMjU2Iiwia2lkIjoidG9rZW5zaWduZXItMjAyNCIsIng1YyI6WyJNSUlDQWpDQ0FhZWdBd0lCQWdJRU5hUm1TekFNQmdncWhrak9QUVFEQWdVQU1IWXhDekFKQmdOVkJBZ1RBa0pYTVJFd0R3WURWUVFIRXdoRmFHNXBibWRsYmpFTE1Ba0dBMVVFQmhNQ1JFVXhEREFLQmdOVkJBb1RBMGxDVFRFWU1CWUdBMVVFQ3hNUFUyVnJTVVJRSUZCeWIyUWdWRVZGTVI4d0hRWURWUVFERXhaVWIydGxibE5wWjI1bGNpMHlNREkwSUZCVklGUkxNQjRYRFRJME1ESXhNekE1TVRJMU0xb1hEVEkxTURNeE56QTVNVEkxTTFvd2RqRUxNQWtHQTFVRUNCTUNRbGN4RVRBUEJnTlZCQWNUQ0VWb2JtbHVaMlZ1TVFzd0NRWURWUVFHRXdKRVJURU1NQW9HQTFVRUNoTURTVUpOTVJnd0ZnWURWUVFMRXc5VFpXdEpSRkFnVUhKdlpDQlVSVVV4SHpBZEJnTlZCQU1URmxSdmEyVnVVMmxuYm1WeUxUSXdNalFnVUZVZ1ZFc3dXVEFUQmdjcWhrak9QUUlCQmdncWhrak9QUU1CQndOQ0FBU3BzLzU0MWRvb3hHVVg0dTM2bmYwbU5KSFhVc3JNT2FneFA2clZFdmtoY3RjUE5DUGJ2MjdGaS9UZE1COFVzSDM3ZUxUOElxanAreXMrTnpCQnV2bkNveUV3SHpBZEJnTlZIUTRFRmdRVUJRN3VncmhWa0pDYzBqdjVNRTlPanR6U3Evd3dEQVlJS29aSXpqMEVBd0lGQUFOSEFEQkVBaUJDTmJFeEtWMVROa2Y0bGVNOU43RzJWMFBHeVVpUzE5RkI1QXpqb0d4UndnSWdCdUgwK2RTMjN1WUtsV0R2ZUpLM2VPdkVpZDFyN0VHTDkrYWNSQVFUUCtZPSJdLCJ4IjoicWJQLWVOWGFLTVJsRi1MdC1wMzlKalNSMTFMS3pEbW9NVC1xMVJMNUlYSSIsInkiOiIxdzgwSTl1X2JzV0w5TjB3SHhTd2ZmdDR0UHdpcU9uN0t6NDNNRUc2LWNJIiwiZXhwIjoxNzQyMjAyNzczLCJhbGciOiJFUzI1NiJ9XX0.PN4Oo4x9GKuj4MjARDRj7zTv_xa094UpuuI9VSG1pGCS3DNFJuARw-8nPQLwYKSIkImGVXim5N2ZJyohQX3Zsg
        """);

    assertTrue(eJwks.isValidAt(Instant.ofEpochSecond(1729256000L)));
    assertEquals("https://idbroker.tk.ehealth-id.de", eJwks.body().iss());
    assertEquals(2, eJwks.body().toJWKSet().size());
  }
}
